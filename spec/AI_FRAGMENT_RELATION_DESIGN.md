# AI 碎片关联功能设计方案

## 概述

让 AI 分析灵感碎片之间的潜在关联，帮助创作者发现隐藏的故事线索和创意连接。

---

## 方案一：智能关联图谱 (Smart Graph) ⭐ 推荐

### 核心概念
AI 分析所有碎片的语义关联，生成可视化的知识图谱，节点是碎片，边是关联关系。

### 功能特性
- **节点**: 每个灵感碎片是一个节点
- **边**: AI 分析出的关联关系（相似主题、情感联系、因果关系等）
- **力导向布局**: 自动排列，关联强的碎片靠近
- **聚类着色**: 不同主题的碎片用不同颜色
- **交互探索**: 点击节点高亮关联路径

### AI 分析维度
```typescript
interface RelationEdge {
  source: string;        // 源碎片 ID
  target: string;        // 目标碎片 ID
  type: 'similar' | 'contrast' | 'sequence' | 'thematic' | 'emotional';
  strength: number;      // 关联强度 0-1
  description: string;   // AI 描述的关联理由
}
```

### UI 设计
```
┌─────────────────────────────────────────────────────────────┐
│  关联图谱                                     [重新分析 ▶]   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│      ┌────────┐         ┌────────┐                        │
│      │ 碎片A  │─────────│ 碎片B  │                        │
│      └───┬────┘ 相似主题 └────┬───┘                        │
│          │                   │                             │
│          │ 因果              │ 情感                        │
│          ▼                   ▼                             │
│      ┌────────┐         ┌────────┐     ┌────────┐         │
│      │ 碎片C  │─────────│ 碎片D  │─────│ 碎片E  │         │
│      └────────┘ 时间序列 └────────┘对比 └────────┘         │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  选中: 碎片A - "雨夜的邂逅"                                  │
│  关联:                                                        │
│    → 碎片B (相似主题): "同样发生在雨天的场景"               │
│    → 碎片C (因果关系): "因为这个相遇导致后续发展"           │
└─────────────────────────────────────────────────────────────┘
```

### 技术实现
- 使用 D3.js 或 Cytoscape.js 绘制图谱
- AI 使用 embedding 计算语义相似度
- 支持缩放、拖拽、筛选

---

## 方案二：智能分组建议 (Smart Groups)

### 核心概念
AI 自动将碎片分组，每组是一个潜在的"章节"或"故事线"，支持一个碎片属于多个组。

### 功能特性
- **自动分组**: AI 根据主题、情感、时间自动分组
- **组名生成**: AI 为每组起一个有故事感的名字
- **重叠支持**: 一个碎片可以属于多个组
- **组间关联**: 显示组与组之间的关系

### AI 输出格式
```typescript
interface SmartGroup {
  id: string;
  name: string;              // AI 生成的组名
  description: string;       // 组的描述
  fragmentIds: string[];     // 包含的碎片
  tags: string[];            // 组的主题标签
  color: string;             // 组的颜色标识
  confidence: number;        // AI 置信度
}
```

### UI 设计
```
┌─────────────────────────────────────────────────────────────┐
│  AI 智能分组                                    [重新分析 ▶] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  🎨 被折叠的午后                    置信度: 92%      │   │
│  │  关于时间、记忆和遗憾的主题集合                        │   │
│  │                                                     │   │
│  │  [碎片A] [碎片C] [碎片F] [碎片H]                     │   │
│  │                                                     │   │
│  │  💡 建议: 这些碎片可以组成一个关于时光倒流的章节       │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  🌧️ 雨天出现的人                    置信度: 85%      │   │
│  │  雨作为情感载体的多个场景                              │   │
│  │                                                     │   │
│  │  [碎片B] [碎片D] [碎片A]                             │   │
│  │                                                     │   │
│  │  💡 建议: 考虑将雨天场景串联成一条情感线索             │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  [碎片A] 同时属于 2 个组                                    │
└─────────────────────────────────────────────────────────────┘
```

---

## 方案三：时间线叙事 (Timeline Narrative)

### 核心概念
AI 按照时间顺序和因果关系排列碎片，生成可能的故事时间线，发现叙事缺口。

### 功能特性
- **时间排序**: 按碎片内的时间线索排序
- **因果推断**: AI 分析碎片间的因果关系
- **缺口识别**: 标出叙事中的时间断层
- **分支探索**: 支持多条时间线（平行宇宙）

### AI 输出格式
```typescript
interface TimelineEvent {
  fragmentId: string;
  position: number;          // 在时间线上的位置
  estimatedTime?: string;    // AI 推断的时间点
  connections: {
    before: string[];        // 前置事件
    after: string[];         // 后续事件
  };
  narrativeRole: 'setup' | 'inciting' | 'rising' | 'climax' | 'falling' | 'resolution';
}
```

### UI 设计
```
┌─────────────────────────────────────────────────────────────┐
│  叙事时间线                                     [重新分析 ▶] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  开端 ─────── 发展 ─────── 高潮 ─────── 结局                 │
│                                                             │
│    ┌───┐      ┌───┐      ┌───┐      ┌───┐                 │
│    │ A │──────│ B │──────│ C │──────│ D │                 │
│    └───┘      └───┘      └───┘      └───┘                 │
│      │          │          │          │                     │
│      ▼          ▼          ▼          ▼                     │
│    设置场景   冲突开始    转折点    结局收束                 │
│                                                             │
│  ⚠️ 发现叙事缺口: C 和 D 之间缺少过渡                       │
│  💡 建议: 补充一个关于角色内心挣扎的碎片                     │
│                                                             │
│  [显示分支时间线] [导出为故事大纲]                           │
└─────────────────────────────────────────────────────────────┘
```

---

## 方案四：主题聚类云 (Theme Cloud)

### 核心概念
AI 提取所有碎片的核心主题，以词云或聚类图的形式展示，点击主题查看相关碎片。

### 功能特性
- **主题提取**: AI 提取关键词和概念
- **层级结构**: 大主题包含子主题
- **热度显示**: 碎片多的主题显示更大
- **交叉分析**: 显示主题之间的交集

### AI 输出格式
```typescript
interface ThemeCluster {
  id: string;
  name: string;
  level: 'primary' | 'secondary' | 'tertiary';
  keywords: string[];
  fragmentIds: string[];
  relatedThemes: string[];   // 关联的其他主题
}
```

### UI 设计
```
┌─────────────────────────────────────────────────────────────┐
│  主题聚类                                       [重新分析 ▶] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                 ┌──────────────┐                           │
│                 │   时间旅行    │  ← 主要主题               │
│                 └──────┬───────┘                           │
│            ┌───────────┼───────────┐                       │
│      ┌─────▼─────┐ ┌──▼────┐ ┌────▼────┐                  │
│      │  时光倒流  │ │ 平行  │ │  时间   │                  │
│      │            │ │ 宇宙  │ │  悖论   │                  │
│      └─────┬──────┘ └───┬───┘ └────┬────┘                  │
│            │            │          │                       │
│      [5碎片]      [3碎片]    [2碎片]                       │
│                                                             │
│  选中: 时间旅行                                             │
│  相关碎片: [A] [C] [E] [F] [H]                              │
│  建议组合: 这些碎片可以构成一个完整的时间旅行故事           │
└─────────────────────────────────────────────────────────────┘
```

---

## 方案五：关系推荐助手 (Relation Assistant)

### 核心概念
AI 主动推荐碎片之间的连接，用户可以选择接受或拒绝，逐步构建碎片关系网。

### 功能特性
- **智能推荐**: AI 分析可能的关联
- **用户确认**: 用户决定是否建立关联
- **关系类型**: 支持多种关系类型标注
- **可视化网络**: 逐步构建关系图谱

### AI 推荐格式
```typescript
interface RelationSuggestion {
  id: string;
  sourceFragmentId: string;
  targetFragmentId: string;
  relationType: 'sequel' | 'prequel' | 'parallel' | 'contrast' | 'reference';
  confidence: number;
  reason: string;            // AI 推荐理由
  userDecision?: 'accepted' | 'rejected' | 'pending';
}
```

### UI 设计
```
┌─────────────────────────────────────────────────────────────┐
│  关系推荐助手                                   [重新分析 ▶] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  AI 发现了 5 个可能的碎片关联:                              │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 碎片A "雨夜的邂逅"  →  碎片B "三年后的重逢"         │   │
│  │                                                     │   │
│  │ 类型: 续集关系 (时间线后续)                         │   │
│  │ 置信度: 89%                                         │   │
│  │                                                     │   │
│  │ AI 理由: 两个碎片都提到"那把蓝色的伞"，可能是同     │   │
│  │ 一个人物的不同时间点的故事                          │   │
│  │                                                     │   │
│  │ [✓ 确认关联]  [✕ 忽略]  [💬 查看详情]               │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  已确认的关联 (12):                                         │
│  [图谱预览]                                                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 方案对比

| 特性 | 方案一<br>关联图谱 | 方案二<br>智能分组 | 方案三<br>时间线 | 方案四<br>主题聚类 | 方案五<br>关系推荐 |
|------|------------------|------------------|----------------|------------------|------------------|
| **可视化** | ⭐⭐⭐ 强 | ⭐⭐⭐ 强 | ⭐⭐⭐ 强 | ⭐⭐ 中等 | ⭐⭐ 中等 |
| **交互性** | ⭐⭐⭐ 高 | ⭐⭐ 中等 | ⭐⭐ 中等 | ⭐⭐ 中等 | ⭐⭐⭐ 高 |
| **AI 复杂度** | ⭐⭐⭐ 高 | ⭐⭐ 中等 | ⭐⭐ 中等 | ⭐⭐ 中等 | ⭐⭐⭐ 高 |
| **实用性** | ⭐⭐⭐ 高 | ⭐⭐⭐ 高 | ⭐⭐⭐ 高 | ⭐⭐ 中等 | ⭐⭐⭐ 高 |
| **实现难度** | ⭐⭐⭐ 难 | ⭐⭐ 中等 | ⭐⭐ 中等 | ⭐⭐ 中等 | ⭐⭐⭐ 难 |
| **独特性** | ⭐⭐⭐ 独特 | ⭐⭐ 常见 | ⭐⭐ 常见 | ⭐⭐ 常见 | ⭐⭐⭐ 独特 |

---

## 我的推荐

### 🥇 首选: 方案一 (关联图谱) + 方案五 (关系推荐)
**理由**:
1. 关联图谱提供最直观的视觉体验
2. 关系推荐提供渐进式构建体验
3. 两者结合可以先用推荐建立基础关联，再用图谱探索全貌

### 🥈 备选: 方案二 (智能分组)
**理由**:
1. 实现相对简单
2. 与现有 AI 分析功能风格一致
3. 用户接受度高

### 🥉 进阶: 方案三 (时间线)
**理由**:
1. 适合特定类型的创作（小说、剧本）
2. 对线性叙事特别有用
3. 可以作为独立功能模块

---

## 实现建议

### 如果你选择方案一 + 方案五:
```
Phase 1: 基础关联分析
- AI 分析碎片语义相似度
- 生成基础关联数据

Phase 2: 关系推荐
- 推荐高置信度的关联
- 用户确认/拒绝机制

Phase 3: 图谱可视化
- D3.js 力导向图
- 交互探索功能

Phase 4: 高级分析
- 社群发现算法
- 中心性分析（找出关键碎片）
```

### 如果你选择方案二:
```
Phase 1: 聚类算法
- K-means 或层次聚类
- 生成初始分组

Phase 2: AI 组名生成
- 用 LLM 为每组起名
- 生成组描述

Phase 3: UI 实现
- 分组卡片展示
- 拖拽调整分组
```

---

## 下一步

你想选择哪个方案？我可以：
1. 为你选择的首选方案创建完整的 SDD 规范
2. 实现该功能的前后端代码
3. 或者结合多个方案的优点设计一个混合方案
